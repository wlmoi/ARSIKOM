// Praktikum EL3011 Arsitektur Sistem Komputer
// Modul       : 2
// Percobaan   : 3
// Tanggal     : 17 November 2025
// Nama (NIM) 1 : Ahmad Fatur Rohman (13223112)
// Nama (NIM) 2 : Bryan R. Ryanto P. (13223065)
// Nama File    : brancher_rv32i.v
// Deskripsi    : Brancher untuk RV32I 

module brancher_rv32i(
    input wire [31:0] PCnew,   // PC+4 dari 4-adder [cite: 363-364]
    input wire [31:0] ALUout,  // PC+imm dari ALU [cite: 367-368]
    input wire signed [31:0] in1, // Nilai di rs1 [cite: 369-371]
    input wire signed [31:0] in2, // Nilai di rs2 [cite: 372-374]
    input wire cu_branch,       // Enable branch [cite: 375-377]
    input wire [2:0] cu_branchtype, // Tipe branch [cite: 378-379]
    output reg [31:0] PCin
);

    // $BEQ=3'b000, $BGE=3'b001, $BGEU=3'b010, $BLT=3'b011,
    // $BLTU=3'b100, $BNE=3'b101 [cite: 379, 382-383]

    always @ (*)
    begin
        if (cu_branch) 
        begin
            case (cu_branchtype) 
                // BEQ (Branch if Equal)
                3'b000: 
                    PCin <= (in1 == in2) ? ALUout : PCnew;
                
                // BGE (Branch if Greater or Equal - Signed)
                3'b001: 
                    PCin <= (in1 >= in2) ? ALUout : PCnew; 
                
                // BGEU (Branch if Greater or Equal - Unsigned)
                3'b010: 
                    PCin <= ($unsigned(in1) >= $unsigned(in2)) ? ALUout : PCnew; 
                
                // BLT (Branch if Less Than - Signed)
                3'b011: 
                    PCin <= (in1 < in2) ? ALUout : PCnew; 
                
                // BLTU (Branch if Less Than - Unsigned)
                3'b100: 
                    PCin <= ($unsigned(in1) < $unsigned(in2)) ? ALUout : PCnew; 
                
                // BNE (Branch if Not Equal)
                3'b101: 
                    PCin <= (in1 != in2) ? ALUout : PCnew; 
                
                // Default: jika tidak ada branch, teruskan PC+4
                default: 
                    PCin <= PCnew; 
            endcase
        end
        else
        begin
            // Jika sinyal cu_branch tidak aktif, teruskan PC+4
            PCin <= PCnew; 
        end
    end

endmodule